# Repeated Call Handling MVP Sample

A tool for analyzing call events to identify repeated calls, determine fault, and recommend appropriate compensation.

## Installation

1. Install `uv` from [uv's installation guide](https://docs.astral.sh/uv/getting-started/installation/)

2. Clone and navigate to the repository:

   ```bash
   cd repeated_calls_mvp_sample
   ```

3. Create a virtual environment:

   ```bash
   uv venv
   ```

4. Activate the environment:

   **Linux/macOS**:

   ```bash
   source .venv/bin/activate
   ```

   **Windows**:

   ```bash
   .venv\Scripts\activate
   ```

5. Install dependencies:

   ```bash
   uv sync
   ```

## Usage

1. Create a `.env` file based on the example below and provide your Azure AI Foundry credentials:

   ```bash
   AZURE_OPENAI_CHAT_DEPLOYMENT_NAME=gpt-4o
   AZURE_OPENAI_ENDPOINT=
   AZURE_OPENAI_API_KEY=
   AZURE_OPENAI_API_VERSION=2025-03-01-preview
   ```

   Note: For best results, use a gpt-4o model deployment as it was used during development.

2. Run the script with a call event ID from the `database/call_event.csv` file:

   ```bash
   uv run main.py <call_event_id>
   ```

## Example Calls

### Example 1: AutoMow 3000 Issue (call ID: c1)

```bash
uv run main.py c1
```

**Summary**: Identifies a repeat call about an AutoMow 3000 mower not operating, determines it's the company's fault due to a software disruption, and recommends a $30 service credit as compensation.

### Example 2: HedgeBot Compact Power Issue (call ID: c2)

```bash
uv run main.py c2
```

**Summary**: Determines this is not a repeat call as it's about a HedgeBot Compact not turning on, which is unrelated to previous calls, and provides troubleshooting guidance without compensation.

### Example 3: HedgeBot Pro Wet Conditions Usage (call ID: c12)

```bash
uv run main.py c12
```

**Summary**: Identifies this as a repeat call about improper HedgeBot Pro usage in wet conditions, determines it's not the company's fault as it's contrary to product instructions, and recommends no compensation.

## Example Responses

Below are sample responses generated by the tool for each example call:

### Response for c1 (AutoMow 3000 Issue)

```json
{
  "repeat_call_analysis": {
    "is_repeat_call": true,
    "related_call_ids": ["h1"],
    "days_since_first_call": 1,
    "issue_summary": "Issues with the AutoMow 3000 self-driving mower not operating.",
    "reasoning": "The current call and the previous call 'h1' involve the same customer, the issue reported ('self-driving mower malfunction') pertains to the same product (AutoMow 3000), and the time between calls is within 7 days, spanning only 1 day. Additionally, the previous call suggested resolution by 2024-01-10, but the issue persists. This qualifies as a repeat call."
  },
  "fault_analysis": {
    "is_our_fault": true,
    "fault_reason": "The issue with the AutoMow 3000 integrating software and connectivity aspects correlates with the operational disruption resolved near the customer's issues, suggesting inadequate resolution or lingering impact.",
    "matching_disruption_ids": ["d7001"],
    "recommended_action": "Verify post-disruption system integrity and reliability for affected users, ensure timely updates to customers, and offer compensation if needed."
  },
  "compensation_recommendation": {
    "recommended_compensation_type": "Service Credit",
    "amount": 30.0,
    "duration": "Annual Service Package Credit"
  },
  "call_agent_summary": {
    "one_sentence_recommendation": "Apologize for the inconvenience, assure the customer we are resolving the issue, and inform them of a $30 service credit applied to their annual package for their patience.",
    "talking_points": [
      "Thank you for contacting us again, Mr. Osborne.",
      "We sincerely apologize for the repeated inconvenience this issue has caused.",
      "Our team has identified a software-related problem that we are actively working to resolve.",
      "To express our commitment to your satisfaction, we are applying a $30 credit to your annual service package.",
      "We appreciate your understanding, and your issue is being treated as a priority."
    ]
  }
}
```

### Response for c2 (HedgeBot Compact Power Issue)

```json
{
  "repeat_call_analysis": {
    "is_repeat_call": false,
    "related_call_ids": [],
    "reasoning": "This call does not appear to be a repeat call because the reason for the current call concerns the HedgeBot Compact device not turning on, which is unrelated to the expired Aquaspray X promotion discussed in a prior call."
  },
  "call_agent_summary": {
    "one_sentence_recommendation": "Guide the customer through troubleshooting steps to resolve the HedgeBot Compact power issue.",
    "compensation_details": "No compensation is required for this call.",
    "technical_resolution": "Confirm that the device is connected properly to a power source and perform a reset using the reset button on the device.",
    "talking_points": [
      "Mr. Lyons, I'm here to assist you with your HedgeBot Compact not powering on.",
      "Let us confirm it is securely connected to a working power outlet.",
      "Please check if the reset button can help restore power to the device.",
      "I will guide you step-by-step to identify and resolve the issue."
    ]
  }
}
```

### Response for c12 (HedgeBot Pro Wet Conditions Usage)

```json
{
  "repeat_call_analysis": {
    "is_repeat_call": true,
    "related_call_ids": ["h17"],
    "days_since_first_call": 2,
    "issue_summary": "The customer is experiencing recurring issues with their HedgeBot Pro related to usage in wet conditions, contrary to product usage instructions.",
    "reasoning": "The current call is classified as a repeat call because the issue pertains to the same product (HedgeBot Pro) and involves the same underlying cause (usage in conditions involving rain or moisture) as the previous call on 2024-05-10. Additionally, the time gap between the two calls is only 2 days, which is within the 7-day window defining a repeat call. Therefore, it meets all the criteria for a repeat call."
  },
  "fault_analysis": {
    "is_our_fault": false,
    "recommended_action": "Reiterate product care guidelines to the customer and advise not to operate the equipment in unsuitable conditions as per the manual.",
    "reasoning": "The issue is clearly outlined in the product manual regarding unsuitable use in wet conditions, which the customer has previously acknowledged as their mistake."
  },
  "call_agent_summary": {
    "one_sentence_recommendation": "Reassure the customer about resolving their concerns while clarifying proper product use in wet conditions.",
    "compensation_details": "No compensation is required as the issue is due to improper usage and not product malfunction.",
    "talking_points": [
      "Hello Reagan, thank you for contacting us again.",
      "Regarding the HedgeBot Pro issue, it's important to follow the guidelines which recommend against using it on wet hedges.",
      "Please refer to the manual for step-by-step instructions on resolving the error code, typically involving drying the appliance thoroughly and performing a reset.",
      "We're here to assist if you encounter any further difficulties."
    ]
  }
}
```
